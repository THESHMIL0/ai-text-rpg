<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Pocket RPG — Simple Mobile RPG</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#7dd3fc;--muted:#94a3b8;--good:#10b981;--bad:#ef4444;}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{background:linear-gradient(180deg,#071127 0%, #071827 100%);color:#e6eef6;display:flex;align-items:center;justify-content:center;padding:16px}
  .app{width:100%;max-width:820px;background:linear-gradient(180deg,var(--card),#061224);border-radius:14px;box-shadow:0 10px 30px rgba(2,6,23,.7);overflow:hidden}
  header{padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.03);display:flex;align-items:center;gap:10px}
  header h1{margin:0;font-size:18px}
  main{display:grid;grid-template-columns:1fr 380px;gap:12px;padding:12px}
  @media(max-width:880px){main{grid-template-columns:1fr;}}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px;min-height:120px}
  .log{height:220px;overflow:auto;padding:8px;background:rgba(0,0,0,0.15);border-radius:8px;font-size:14px}
  .stats{display:flex;flex-wrap:wrap;gap:8px}
  .stat{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;min-width:110px;text-align:center}
  .buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  button{flex:1;min-width:80px;padding:10px;border-radius:10px;border:0;background:linear-gradient(180deg,var(--accent),#3cc9ef);color:#012331;font-weight:700;font-size:15px;box-shadow:0 6px 14px rgba(0,0,0,.4)}
  .secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);font-weight:600}
  .small{padding:8px;font-size:13px}
  .muted{color:var(--muted);font-size:13px}
  .center{text-align:center}
  footer{padding:12px;border-top:1px solid rgba(255,255,255,.02);display:flex;gap:8px;align-items:center;justify-content:space-between}
  .shop{display:flex;flex-direction:column;gap:8px}
  .item{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}
  input[type=text],select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .big{font-size:16px;padding:12px}
  .hpbar{height:10px;border-radius:999px;background:rgba(255,255,255,.06);overflow:hidden}
  .hpfill{height:100%;background:linear-gradient(90deg,#10b981,#7dd3fc)}
  .danger{background:linear-gradient(90deg,#ef4444,#f97316)}
  .action-row{display:flex;gap:8px;margin-top:8px}
  .muted-btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.02);color:var(--muted)}
  .small-note{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <h1>Pocket RPG</h1>
    <div class="muted small-note">Tiny text-RPG — mobile-first</div>
  </header>

  <main>
    <section class="panel">
      <div id="setupArea">
        <div class="center">
          <input id="playerName" type="text" placeholder="Enter your name (e.g. Arin)" />
          <div style="height:8px"></div>
          <select id="playerClass" >
            <option value="warrior">Warrior — high HP, medium damage</option>
            <option value="rogue">Rogue — medium HP, higher crit chance</option>
            <option value="mage">Mage — low HP, high damage spells</option>
          </select>
          <div style="height:8px"></div>
          <button id="startBtn" class="big">Start Adventure</button>
        </div>
        <div style="height:12px"></div>
        <div class="muted small-note">Tip: your progress is saved in the browser (localStorage).</div>
      </div>

      <div id="gameArea" style="display:none">
        <div class="stats" id="playerStats"></div>

        <div style="height:10px"></div>
        <div class="log" id="log"></div>

        <div class="action-row" id="actions">
          <button id="fightBtn">Fight</button>
          <button id="shopBtn" class="secondary">Shop</button>
          <button id="restBtn" class="secondary">Rest</button>
          <button id="saveBtn" class="muted-btn">Save</button>
        </div>

        <div id="combatActions" style="display:none" class="action-row">
          <button id="attackBtn">Attack</button>
          <button id="defendBtn" class="secondary">Defend</button>
          <button id="potionBtn" class="secondary">Use Potion</button>
          <button id="runBtn" class="secondary">Run</button>
        </div>
      </div>
    </section>

    <aside class="panel">
      <div class="center"><strong>Shop & Inventory</strong></div>
      <div style="height:10px"></div>
      <div class="shop" id="shop">
        <!-- items injected here -->
      </div>

      <div style="height:12px"></div>
      <div><strong>Inventory</strong></div>
      <div id="inventoryList" style="margin-top:8px"></div>
    </aside>
  </main>

  <footer>
    <div class="muted small-note">Made for mobile — paste into index.html</div>
    <div>
      <button id="exportBtn" class="secondary small">Export Save</button>
      <button id="importBtn" class="secondary small">Import Save</button>
    </div>
  </footer>
</div>

<script>
/* Simple mobile-friendly RPG
   - Save/load via localStorage
   - Combat with enemies, XP, leveling, simple shop
*/

// ====== Data & Helpers ======
const ITEMS = [
  {id:'potion',name:'Health Potion',desc:'Restores 40 HP',price:15},
  {id:'strongPotion',name:'Strong Potion',desc:'Restores 80 HP',price:40},
  {id:'ironSword',name:'Iron Sword',desc:'+3 attack',price:60},
];

const ENEMIES = [
  {name:'Rat',hp:30,att:6,xp:12,gold:8},
  {name:'Bandit',hp:55,att:10,xp:26,gold:18},
  {name:'Wolf',hp:70,att:12,xp:34,gold:28},
  {name:'Orc',hp:110,att:16,xp:70,gold:60},
];

function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

// ====== Game State ======
let state = {
  player: null,
  enemy: null,
  inCombat: false,
};

// ====== DOM ======
const el = {
  setupArea: document.getElementById('setupArea'),
  gameArea: document.getElementById('gameArea'),
  playerName: document.getElementById('playerName'),
  playerClass: document.getElementById('playerClass'),
  startBtn: document.getElementById('startBtn'),
  playerStats: document.getElementById('playerStats'),
  log: document.getElementById('log'),
  fightBtn: document.getElementById('fightBtn'),
  shopBtn: document.getElementById('shopBtn'),
  restBtn: document.getElementById('restBtn'),
  saveBtn: document.getElementById('saveBtn'),
  combatActions: document.getElementById('combatActions'),
  attackBtn: document.getElementById('attackBtn'),
  defendBtn: document.getElementById('defendBtn'),
  potionBtn: document.getElementById('potionBtn'),
  runBtn: document.getElementById('runBtn'),
  shop: document.getElementById('shop'),
  inventoryList: document.getElementById('inventoryList'),
  exportBtn: document.getElementById('exportBtn'),
  importBtn: document.getElementById('importBtn'),
};

// ====== Player creation ======
function newPlayer(name,cls){
  let base = {name,level:1,xp:0,gold:50,inventory:{potion:2},equips:{attack:0}};
  if(cls==='warrior'){
    base.maxHp=140; base.hp=140; base.attack=12; base.crit=6;
  } else if(cls==='rogue'){
    base.maxHp=110; base.hp=110; base.attack=10; base.crit=14;
  } else {
    base.maxHp=85; base.hp=85; base.attack=14; base.crit=8;
  }
  return {...base,cls};
}

// ====== Rendering ======
function appendLog(text, color){
  const p = document.createElement('div');
  p.innerHTML = text;
  if(color) p.style.color = color;
  el.log.appendChild(p);
  el.log.scrollTop = el.log.scrollHeight;
}
function renderStats(){
  const p = state.player;
  el.playerStats.innerHTML = `
    <div class="stat"><strong>${p.name}</strong><div class="muted">${p.cls} • Lv ${p.level}</div></div>
    <div class="stat"><div>HP</div><div style="height:8px"></div>
      <div class="hpbar"><div class="hpfill" style="width:${(p.hp/p.maxHp)*100}%"></div></div>
      <div class="muted">${p.hp} / ${p.maxHp}</div></div>
    <div class="stat"><div>Attack</div><div style="font-weight:700">${p.attack + (p.equips.attack||0)}</div></div>
    <div class="stat"><div>XP</div><div class="muted">${p.xp} / ${xpToLevel(p.level)}</div></div>
    <div class="stat"><div>Gold</div><div style="font-weight:700">${p.gold}</div></div>
  `;
  renderInventory();
}
function renderShop(){
  el.shop.innerHTML = '';
  ITEMS.forEach(it=>{
    const row = document.createElement('div'); row.className='item';
    row.innerHTML = `<div><strong>${it.name}</strong><div class="muted small-note">${it.desc}</div></div>
                     <div style="text-align:right">
                       <div class="muted small-note">₹${it.price}</div>
                       <div style="height:6px"></div>
                       <button class="small" onclick="buyItem('${it.id}')">Buy</button>
                     </div>`;
    el.shop.appendChild(row);
  });
}
function renderInventory(){
  el.inventoryList.innerHTML = '';
  const inv = state.player.inventory;
  for(const k in inv){
    const item = ITEMS.find(i=>i.id===k);
    if(!item) continue;
    const row = document.createElement('div'); row.className='item';
    row.innerHTML = `<div><strong>${item.name}</strong><div class="muted small-note">${item.desc}</div></div>
                     <div style="text-align:right">
                       x${inv[k]} <div style="height:6px"></div>
                       <button class="small" onclick="useItem('${k}')">Use</button>
                     </div>`;
    el.inventoryList.appendChild(row);
  }
  if(Object.keys(inv).length===0) el.inventoryList.innerHTML = '<div class="muted small-note">Empty</div>';
}

// ====== Game mechanics ======
function xpToLevel(l){ return 30 + (l-1)*40; }

function levelCheck(){
  while(state.player.xp >= xpToLevel(state.player.level)){
    state.player.xp -= xpToLevel(state.player.level);
    state.player.level++;
    state.player.maxHp += 12;
    state.player.attack += 2;
    state.player.hp = state.player.maxHp;
    appendLog(`<strong>Level up! You reached level ${state.player.level}</strong>`, 'goldenrod');
  }
  renderStats();
}

function startCombat(){
  if(state.inCombat) return;
  state.inCombat = true;
  state.enemy = JSON.parse(JSON.stringify(ENEMIES[randInt(0,ENEMIES.length-1)]));
  appendLog(`<strong>Encounter: ${state.enemy.name} appears!</strong>`, '#fbbf24');
  el.combatActions.style.display = 'flex';
  el.actions.style.display = 'none';
  renderStats();
}

function endCombat(won){
  state.inCombat = false;
  el.combatActions.style.display = 'none';
  el.actions.style.display = 'flex';
  if(won){
    appendLog(`<strong>You defeated the ${state.enemy.name}!</strong>`, '#a7f3d0');
    state.player.xp += state.enemy.xp;
    state.player.gold += state.enemy.gold;
    levelCheck();
  } else {
    appendLog(`<strong>You fled or were defeated.</strong>`, 'var(--muted)');
  }
  state.enemy = null;
  saveToStorage();
  renderStats();
}

function enemyTurn(defending=false){
  if(!state.enemy || state.player.hp<=0) return;
  const dmg = Math.max(1, state.enemy.att + randInt(-3,3) - (defending?4:0));
  state.player.hp = clamp(state.player.hp - dmg, 0, state.player.maxHp);
  appendLog(`Enemy ${state.enemy.name} hits you for ${dmg} damage.`);
  if(state.player.hp <= 0){
    appendLog(`<strong>You fell in battle...</strong>`, 'var(--bad)');
    // lose some gold & xp
    state.player.gold = Math.max(0, Math.floor(state.player.gold * 0.6));
    state.player.xp = Math.max(0, state.player.xp - 5);
    endCombat(false);
  }
  renderStats();
}

// ====== Actions exposed to buttons ======
window.buyItem = function(itemId){
  const item = ITEMS.find(i=>i.id===itemId);
  if(!item) return;
  if(state.player.gold < item.price){ appendLog("Not enough gold."); return; }
  state.player.gold -= item.price;
  state.player.inventory[itemId] = (state.player.inventory[itemId]||0) + 1;
  appendLog(`Bought ${item.name}.`);
  renderStats();
  saveToStorage();
};

window.useItem = function(itemId){
  const count = state.player.inventory[itemId]||0;
  if(count<=0){ appendLog("No item to use."); return; }
  if(itemId==='potion'){
    state.player.hp = clamp(state.player.hp + 40, 0, state.player.maxHp);
    appendLog("You used a Health Potion. +40 HP");
  } else if(itemId==='strongPotion'){
    state.player.hp = clamp(state.player.hp + 80, 0, state.player.maxHp);
    appendLog("You used a Strong Potion. +80 HP");
  } else if(itemId==='ironSword'){
    state.player.equips.attack = 3;
    appendLog("Equipped Iron Sword: +3 attack");
  }
  state.player.inventory[itemId] = count - 1;
  if(state.player.inventory[itemId] <= 0) delete state.player.inventory[itemId];
  renderStats();
  saveToStorage();
};

// start fight
el.fightBtn.addEventListener('click', ()=> startCombat());
el.shopBtn.addEventListener('click', ()=> { renderShop(); appendLog('Opened the shop.'); });
el.restBtn.addEventListener('click', ()=>{
  state.player.hp = state.player.maxHp;
  appendLog('You rested and restored HP.');
  renderStats(); saveToStorage();
});
el.saveBtn.addEventListener('click', ()=> { saveToStorage(); appendLog('Game saved.'); });

// combat controls
el.attackBtn.addEventListener('click', ()=>{
  if(!state.inCombat||!state.enemy) return;
  const player = state.player;
  const crit = (Math.random()*100 < player.crit) ? 1.6 : 1.0;
  let dmg = Math.round((player.attack + (player.equips.attack||0) + randInt(-3,3)) * crit);
  state.enemy.hp = clamp(state.enemy.hp - dmg, 0, state.enemy.hp);
  appendLog(`You hit ${state.enemy.name} for ${dmg}${crit>1? ' (CRIT!)':''}.`);
  if(state.enemy.hp <= 0){
    endCombat(true);
    return;
  }
  enemyTurn(false);
});
el.defendBtn.addEventListener('click', ()=>{
  appendLog('You brace for the enemy strike.');
  enemyTurn(true);
});
el.potionBtn.addEventListener('click', ()=>{
  useBestPotion();
});
el.runBtn.addEventListener('click', ()=>{
  const success = Math.random() < 0.5;
  appendLog(success ? 'You escaped!' : 'Could not escape!');
  if(success) endCombat(false);
  else enemyTurn(false);
});

// import/export
el.exportBtn.addEventListener('click', ()=>{
  const data = JSON.stringify(state.player);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = `${state.player.name || 'rpg_save'}.json`;
  a.click(); URL.revokeObjectURL(url);
});
el.importBtn.addEventListener('click', ()=>{
  const input = document.createElement('input'); input.type='file'; input.accept='application/json';
  input.onchange = e => {
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try{
        const json = JSON.parse(ev.target.result);
        state.player = json;
        appendLog('Imported save file.');
        enterGame();
      }catch(err){ appendLog('Import failed: invalid file.'); }
    };
    reader.readAsText(f);
  };
  input.click();
});

// helper: use best potion automatically
function useBestPotion(){
  if((state.player.inventory.strongPotion||0) > 0) return useItem('strongPotion');
  if((state.player.inventory.potion||0) > 0) return useItem('potion');
  appendLog('No potions available.');
}

// ====== Save / Load ======
function saveToStorage(){
  if(!state.player) return;
  localStorage.setItem('pocketRpgSave', JSON.stringify(state.player));
}
function loadFromStorage(){
  const raw = localStorage.getItem('pocketRpgSave');
  if(!raw) return null;
  try { return JSON.parse(raw); } catch(e){ return null; }
}

// ====== Start / Enter game ======
function enterGame(){
  el.setupArea.style.display = 'none';
  el.gameArea.style.display = 'block';
  renderShop();
  renderStats();
  appendLog('Welcome, ' + state.player.name + '!');
}

el.startBtn.addEventListener('click', ()=>{
  const name = el.playerName.value.trim() || 'Hero';
  const cls = el.playerClass.value;
  state.player = newPlayer(name, cls);
  saveToStorage();
  enterGame();
});

// Load saved automatically if exists
(function init(){
  const saved = loadFromStorage();
  if(saved){
    // ask quickly: automatic restore — we won't prompt UI; just restore
    state.player = saved;
    enterGame();
    appendLog('Save loaded from your browser.');
  } else {
    appendLog('Create a hero to start your adventure.');
  }
})();

// expose for debugging on mobile console
window.__state = state;
</script>
</body>
</html>